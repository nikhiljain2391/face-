<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>HDFC Life</title>
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="shortcut icon" href="images/favicon.ico">
<link rel="stylesheet" href="css/bootstrap.min.css">
<link rel="stylesheet" href="css/style.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="https://web.archive.org/web/20140814064901/http://www.nihilogic.dk/labs/exif/exif.js" type="text/javascript"></script>
<script src="https://web.archive.org/web/20140814064903/http://www.nihilogic.dk/labs/binaryajax/binaryajax.js" type="text/javascript"></script>
<script>
	var createBinaryFile = function(uintArray) {
	    var data = new Uint8Array(uintArray);
	    var file = new BinaryFile(data);
	    file.getByteAt = function(iOffset) {
	        return data[iOffset];
	    };
	    file.getBytesAt = function(iOffset, iLength) {
	        var aBytes = [];
	        for (var i = 0; i < iLength; i++) {
	            aBytes[i] = data[iOffset  + i];
	        }
	        return aBytes;
	    };
	    file.getLength = function() {
	        return data.length;
	    };
	    return file;
	};
	function openBrowse(){
		localStorage.removeItem("image_url");
		localStorage.removeItem("age");
		localStorage.removeItem("gender");

		document.getElementById('capture').click();
	}



	function handleChange(event){
		var reader = new FileReader();
    if(event.target.files && event.target.files[0]){
      reader.readAsDataURL(event.target.files[0]); // read file as data url
        //this.fileChange(event);
        reader.onload = (event) => { // called once readAsDataURL is completed

					var tempImg = new Image();
          tempImg.src = reader.result;
          tempImg.onload = function() {
         		var MAX_WIDTH = 1024;
            var MAX_HEIGHT = 768;
            var tempW = tempImg.width;
            var tempH = tempImg.height;
            if (tempW > tempH) {
                if (tempW > MAX_WIDTH) {
                   tempH *= MAX_WIDTH / tempW;
                   tempW = MAX_WIDTH;
                }
            } else {
                if (tempH > MAX_HEIGHT) {
                   tempW *= MAX_HEIGHT / tempH;
                   tempH = MAX_HEIGHT;
                }
            }


            var canvas = document.createElement('canvas');
            canvas.width = tempW;
            canvas.height = tempH;
            var ctx = canvas.getContext("2d");
						var iOS = !!navigator.platform && /iPad|iPhone|iPod/.test(navigator.platform);
						if(iOS==true){
							width = img.height;
              height = img.width;
              transform = "right";
							ctx.setTransform(0, 1, -1, 0, width, 0);
						}
            ctx.drawImage(this, 0, 0, tempW, tempH);
            var dataURL = canvas.toDataURL("image/jpeg");
						$(".loader-container").show()
	          var url = {
							base64 : dataURL
						}
						localStorage.setItem("image_url",dataURL)
	          getImageDetails(url);
          }

          // console.log(url);
        }
    }else{

    }
	}


	function getImageDetails(url){

		axios.post("http://52.66.44.56:3000/getData", url).then(
				response => {
						let res = response.data
						console.log(res)
						if(JSON.stringify(res).indexOf("413 Request Entity Too Large") > -1){
								//dispatch({type: "LARGE_FILE"})
								$(".loader-container").hide()
						}else{
								if(res.data.faces){
										if(res.data.faces.length === 0){
												dispatch({type: "NO_FACE"})
										}else{
												let age = res.data.faces[0].attributes.age.value;
												let gender = res.data.faces[0].attributes.gender.value;
												let image_name = res.image_name;
												localStorage.setItem("age",age)
												localStorage.setItem("gender",gender)
												window.open("second.html","_self")
												// let soap_first= '<?xml version="1.0" encoding="UTF-8"?><SOAP-ENV:Envelope xmlns:ns0="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ns1="http://TEBT_QuoteGeneration/QuoteGeneration_TP" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/"><SOAP-ENV:Header/><ns0:Body><ns1:generatequote><generatequoteReq><head><source>OCP_ONLINE</source><userid>kuliza_ocp_001</userid><txnid>FIN-81989</txnid></head><body><quotedtls><jnk>N</jnk><sumAssured>10000000</sumAssured><term>40</term><ppt>40</ppt><freq>FREQ_1</freq><touchpoint>OCP</touchpoint><product>C2P3DPER</product><option>3D Life</option><tobstatus>N</tobstatus><lifeassured>'
                        //
												// if(gender=="Female"){
												// 	var gender_pre = "GEN_F"
												// }else{
												// 	var gender_pre = "GEN_M"
												// }
                        //
												// var dob = "01/01/"+(2018-age)
                        //
												// let soap_mid='<dob>'+dob+'</dob><gender>'+gender_pre+'</gender>'
                        //
												// let soal_last = '</lifeassured><pptOption>REGULAR</pptOption></quotedtls><outputFmt>JSON</outputFmt><agentcd>00488538</agentcd><generateonlyflag>Y</generateonlyflag></body></generatequoteReq></ns1:generatequote></ns0:Body></SOAP-ENV:Envelope>'


												// $.post( "http://124.30.32.37:9082/TEBT_QuoteGenerationWeb/sca/QuoteGeneration_ThirdPartyExport",soap_first+soap_mid+soal_last, function( data ) {
												//   console.log(soap_first+soap_mid+soal_last)
												// });
												// axios.post("http://124.30.32.37:9082/TEBT_QuoteGenerationWeb/sca/QuoteGeneration_ThirdPartyExport", soap_first+soap_mid+soal_last,{headers: {'Access-Control-Allow-Origin': '*'}}).then(
												// 		response => {
												// 				let res = JSON.parse(response.data);
												// 				console.log(response,res)
												// 			}).catch(err => {
												// 					console.log(err);
												// 					$(".loader-container").hide()
												// 					//dispatch({type: "NO_DATAS"});
												// 			})
										}
								}else{
										console.log("No Face found");
										$(".loader-container").hide()
										//dispatch({type: "TECH_ERROR"});
								}
						}
				}
		).catch(err => {
				console.log(err);
				$(".loader-container").hide()
				//dispatch({type: "NO_DATAS"});
		})
	}
</script>
</head>

<body>
	<header>
		<div class="container">
			<div class="text-left">
				<a href="#"><img src="images/logo.svg" alt="logo" /></a>
			</div>
		</div>
	</header>
	<section class="banno">
		<div class="container">
			<img src="images/ban1.png" class="img-responsive text-center" alt="banner"/>
			<a href="#" class="cambtn">
				<img src="images/cambtn.svg" alt="camera" onclick="openBrowse()">
				<input type="file" accept="image/*" id="capture" capture="camera" style="display:none" onChange="handleChange(event)"/>
			</a>
			<p class="despiko text-center" style="margin-top:32px">Ensure your face is well lit, remove glasses, and push hair away from face.</p>
			<h1><strong>TAKE A SELFIE</strong> <span class="thin">& GET AN INSURANCE QUOTE</span></h1>
			<p class="despiko text-center">Your selfie will be used to to provide an estimate for life insurance based on an estimate of your age, gender, and BMI. By clicking “Submit a Selfie” you confirm that you are 20 years of age or older and agree to the Privacy Policy.</p>
			<a class="calltoact"  onclick="openBrowse()">Get My Quote <img src="images/right-arrow.svg" width="16" alt="" class="arrow" /></a>
		</div>
	</section>
	<div class="loader-container">
		<div class="loader">
			<img src="images/loader.gif" alt="loader" class="img-responsive">
		</div>
	</div>
</body>
</html>
